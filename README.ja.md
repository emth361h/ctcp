# Docker VPS マネージャー ウェブコンソール

VPSサーバー上のDockerコンテナ、ネットワーク、イメージ、リソースを管理するためのウェブベースのコントロールパネルです。このアプリケーションは、包括的なDocker管理のためのユーザーインターフェースと管理者インターフェースの両方を提供します。

## 機能

### ユーザー機能
- コンテナ管理（作成、起動、停止、再起動、削除）
- ネットワーク管理（作成、接続、切断、削除）
- イメージ管理（取得、ビルド、削除）
- Docker Compose管理
- Dockerfile管理
- リソースモニタリング（CPU、メモリ、ストレージ）

### 管理者機能
- すべてのユーザー機能
- ユーザー管理（ユーザーの作成、編集、削除）
- ユーザーごとのリソース割り当て
- システム全体のモニタリング
- 詳細なリソース使用統計

## アーキテクチャ

このアプリケーションは、以下の技術を使用して構築されています：

- **バックエンド**: Node.js と Express
- **フロントエンド**: React と TypeScript と Material UI
- **データベース**: MongoDB
- **プロキシ**: Nginx
- **コンテナ化**: Docker と Docker Compose

## 前提条件

- Ubuntu 24.04（または互換性のあるLinuxディストリビューション）
- Docker と Docker Compose がインストールされていること
- Git（リポジトリのクローン用）

## インストール

1. リポジトリをクローンします：
   ```
   git clone <repository-url>
   cd docker-vps-manager
   ```

2. 前提条件を確認します：
   ```
   ./check-prerequisites.sh
   ```

3. セットアップスクリプトを実行します：
   ```
   ./setup.sh
   ```

4. アプリケーションを起動します：
   ```
   ./start.sh
   ```

5. アプリケーションにアクセスします：
   - ブラウザを開き、`http://localhost` にアクセスします
   - デフォルトの管理者認証情報: admin@example.com / adminpassword

## メンテナンス

### ステータス

アプリケーションのステータスを確認するには：
```
./status.sh
```
これにより、すべてのコンテナのステータス、リソース使用状況、ネットワークステータス、サービスのアクセス可能性が表示されます。

### モニタリング

Dockerコンテナのリソース使用状況をリアルタイムでモニタリングするには：
```
./monitor.sh [更新間隔（秒）]
```
更新間隔を指定しない場合、デフォルトは5秒です。

### ログ

アプリケーションのログを表示するには：
```
./logs.sh [オプション]
```

オプション：
- `-s, --service SERVICE`: ログを表示するサービス（backend, frontend, nginx, mongo, all）
- `-l, --lines LINES`: 表示する行数（デフォルト: 100）
- `-f, --follow`: ログ出力をフォローする
- `-h, --help`: ヘルプメッセージを表示する

例：
```
./logs.sh                     # すべてのサービスの最後の100行のログを表示
./logs.sh -s backend          # バックエンドサービスの最後の100行のログを表示
./logs.sh -s backend -l 50    # バックエンドサービスの最後の50行のログを表示
./logs.sh -s backend -f       # バックエンドサービスのログをフォロー
```

### バックアップと復元

データのバックアップを作成するには：
```
./backup.sh
```

バックアップから復元するには：
```
./restore.sh backups/vps-manager-backup-YYYY-MM-DD_HH-MM-SS.tar.gz
```

### 起動と停止

アプリケーションを起動するには：
```
./start.sh
```

アプリケーションまたは特定のサービスを停止するには：
```
./stop.sh [サービス]
```

`[サービス]` はオプションで、backend, frontend, nginx, mongo, all のいずれかを指定できます。指定しない場合、すべてのサービスが停止されます。

### 再起動

アプリケーションまたは特定のサービスを再起動するには：
```
./restart.sh [サービス]
```

`[サービス]` はオプションで、backend, frontend, nginx, mongo, all のいずれかを指定できます。指定しない場合、すべてのサービスが再起動されます。

### アップデート

アプリケーションを最新バージョンに更新するには：
```
./update.sh
```

### クリーンアップ

未使用のDockerリソース（コンテナ、ネットワーク、ボリューム、イメージ）をクリーンアップするには：
```
./cleanup.sh
```
このスクリプトは、未使用のDockerリソースを削除してディスク容量を解放するのに役立ちます。

### ユーザー管理

コマンドラインから新しいユーザーを作成するには：
```
./create-user.sh
```
このスクリプトは、ユーザーの詳細（ユーザー名、メール、パスワード、ロール、リソース制限）の入力を求め、新しいユーザーアカウントを作成します。

システム内のすべてのユーザーを一覧表示するには：
```
./list-users.sh
```
このスクリプトは、システム内のすべてのユーザーに関する情報（リソース制限やアカウントステータスを含む）を表示します。

### 管理者パスワードのリセット

管理者パスワードを忘れた場合は、次のコマンドでリセットできます：
```
./reset-admin-password.sh
```
このスクリプトは新しいパスワードの入力を求め、データベース内の管理者ユーザーのパスワードを更新します。

### アンインストール

アプリケーションをアンインストールするには：
```
./uninstall.sh
```

## プロジェクト構造

```
.
├── backend/                 # バックエンドAPI
│   ├── src/                 # ソースコード
│   │   ├── controllers/     # リクエストハンドラ
│   │   ├── middleware/      # Expressミドルウェア
│   │   ├── models/          # Mongooseモデル
│   │   ├── routes/          # APIルート
│   │   ├── utils/           # ユーティリティ関数
│   │   └── index.js         # エントリーポイント
│   ├── data/                # データストレージ
│   │   ├── compose/         # Docker Composeファイル
│   │   └── dockerfiles/     # Dockerfileストレージ
│   └── Dockerfile           # バックエンドDockerイメージ
├── frontend/                # フロントエンドReactアプリ
│   ├── src/                 # ソースコード
│   │   ├── components/      # 再利用可能なコンポーネント
│   │   ├── context/         # Reactコンテキスト
│   │   ├── pages/           # ページコンポーネント
│   │   ├── utils/           # ユーティリティ関数
│   │   ├── App.tsx          # メインアプリコンポーネント
│   │   └── index.tsx        # エントリーポイント
│   └── Dockerfile           # フロントエンドDockerイメージ
├── nginx/                   # Nginx設定
│   ├── conf/                # 設定ファイル
│   └── Dockerfile           # NginxのDockerイメージ
├── data/                    # 永続データ
│   └── mongo/               # MongoDBデータ
└── docker-compose.yml       # Docker Compose設定
```

## 開発

### バックエンド開発

```
cd backend
npm install
npm run dev
```

### フロントエンド開発

```
cd frontend
npm install
npm start
```

## API ドキュメント

APIドキュメントは、アプリケーション実行時に `/api/docs` で利用できます。

## セキュリティに関する考慮事項

- アプリケーションは認証にJWTを使用しています
- すべてのAPIエンドポイントは認証ミドルウェアで保護されています
- 管理者専用ルートはロールベースの認可で保護されています
- コンテナリソース制限はユーザーごとに適用されます

## ライセンス

このプロジェクトはMITライセンスの下でライセンスされています - 詳細はLICENSEファイルを参照してください。

## 貢献

貢献は歓迎します！プルリクエストを自由に提出してください。
